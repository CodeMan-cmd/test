package controller;

import java.sql.Date;
import java.util.List;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import pojo.Books;
import pojo.User;

import service.BooksService;
import util.Page;

@Controller
public class IndexController {
	@Resource
	private BooksService booksService;
	
	// 分页查询
		@RequestMapping("/cc")
		protected String handleRequestInternal(
				@RequestParam(value = "userCode", required = false) String userCode,
				@RequestParam(value = "userName", required = false) String userName,
				@RequestParam(value = "dangqianyema", required = false) String dangqianyema,
				HttpServletRequest req, HttpServletResponse res) throws Exception {
			Books u = new Books();
			Page p = new Page();
			if (!"".equals(dangqianyema) && null != dangqianyema) {
				// 当前页数不为空时添加当前页数
				p.setDangqianyema(Integer.parseInt(dangqianyema));// String类型 强 转换成
																	// int 类型

			}
			if (!"".equals(userCode) && null != userCode) {
				// userCode不为空添加userCode
				u.setUserCode(userCode);
				req.setAttribute("userCode", userCode);
			}
			if (!"".equals(userName) && null != userName) {
				String userNameNew = new String(userName.getBytes("iso-8859-1"),
						"utf-8");
				System.out.println(userNameNew);
				// userName不为空添加userName
				u.setUserName(userNameNew);
				req.setAttribute("userName", userNameNew);
			}
			List<Books> list = booksService.getAllUser(u, p);
			// 保存查询道的User集合
			req.setAttribute("list", list);

			req.setAttribute("p", p);
			return "index";
		}
	
	
	
	@RequestMapping("/insertBooksAdd")
	public String insertBooks(){
		return "KaoTiIndex2";
	}
	@RequestMapping("/insertBooks")
	public String insert(
			@RequestParam(value = "bookName", required = false) String bookName,
			@RequestParam(value = "bookAuthor", required = false) String bookAuthor,
			@RequestParam(value = "bookPublish", required = false) String bookPublish,
			@RequestParam(value = "bookPage", required = false) int bookPage,
			@RequestParam(value = "bookPrice", required = false) Double bookPrice,
			@RequestParam(value = "createDate", required = false) Date createDate){
		Books b=new Books(bookName, bookAuthor, bookPublish, bookPage, bookPrice, createDate);
		if (b!=null) {
			booksService.insertBooks(b);
		}
		return "KaoTiIndex1";
	}
	
	@RequestMapping("/selectBooks")
	public String selectBooks(HttpServletRequest req){
		List<Books> list=booksService.selectBooks();
		req.setAttribute("list",list);
		return "KaoTiIndex1";
	}
}
